RUN: not mkblob 2>&1 | check-diff %s NO-REPO %t
NO-REPO: error: no such repo: ''
RUN: rm -rf %t
RUN: not mkblob %t 5 2>&1 | sed -e "s,'%t',missing-repo," \
RUN:   | check-diff %s MISSING-REPO %t
MISSING-REPO: error: no such repo: missing-repo

RUN: rm -rf %t-bad-repo
RUN: mkdir -p %t-bad-repo
RUN: not mkblob %t-bad-repo 5 2>&1 | sed -e "s,'%t-bad-repo',bad-repo," \
RUN:   | check-diff %s BAD-REPO %t
BAD-REPO: error: invalid repo: bad-repo

RUN: mkrepo %t
RUN: not git -C %t log | check-empty
RUN: not mkblob %t
RUN: mkblob %t a
RUN: cat %t/a | check-diff %s A %t
A: a
RUN: git -C %t log --date=raw \
RUN:      --format=format:%%an%%n%%cn%%n%%ae%%n%%ce%%n%%ad%%n%%cd%%n%%B \
RUN:   | check-diff %s LOG %t
LOG: mkblob.sh
LOG: mkblob.sh
LOG: mkblob@apple.llvm
LOG: mkblob@apple.llvm
LOG: 1550000000 +0000
LOG: 1550000000 +0000
LOG: mkblob: a
LOG:
LOG: added the blob a

RUN: not mkblob %t a 2>&1 | check-diff %s DUPLICATE %t
DUPLICATE: error: blob already exists: 'a'

# Customize message.
RUN: mkblob %t b -m "my message"
RUN: cat %t/b | check-diff %s B %t
B: b
RUN: git -C %t log --no-walk --format=format:%B | check-diff %s BMSG %t
BMSG: my message

# Customize message in file.
RUN: echo "subject"  >%t.msg
RUN: echo ""        >>%t.msg
RUN: echo "body"    >>%t.msg
RUN: mkblob %t c -F %t.msg
RUN: cat %t/c | check-diff %s C %t
C: c
RUN: git -C %t log --no-walk --format=format:%B | check-diff %s CMSG %t
CMSG: subject
CMSG:
CMSG: body
